<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>٩٩٩ لأرقام السيارات — سحب مضبوط</title>

  <!-- Tajawal -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Preload للخط -->
  <link rel="preload" as="font" href="./assets/fonts/fe.woff2?v=1" type="font/woff2" crossorigin>

  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

  <style>
    /* تحميل الخط بصيغ WOFF2/WOFF (أفضل دعم على GitHub Pages) */
    @font-face{
      font-family:"FE-Schrift";
      src:
        url("./assets/fonts/fe.woff2?v=1") format("woff2"),
        url("./assets/fonts/fe.woff?v=1") format("woff");
      font-display:swap;
    }

    :root{
      --digits-font:"FE-Schrift","Tajawal",sans-serif;
      --canvas-w:540px;  /* 9:16 */
      --canvas-h:960px;
    }

    html, body, .top-category, .top-number, .car-category, .car-number {
      font-synthesis-weight:none;
      font-synthesis-style:none;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .top-number, .car-number {
      font-variant-numeric: tabular-nums lining-nums;
    }

    body{font-family:'Tajawal',sans-serif;background:#e9e9e9;padding:16px;text-align:center}
    h2{margin:8px 0 14px}

    #capture{
      width:var(--canvas-w);height:var(--canvas-h);margin:0 auto;
      background:url('bg-9x16.png') no-repeat center/cover;
      position:relative; overflow:hidden; border-radius:14px; box-shadow:0 8px 24px rgba(0,0,0,.08);
      touch-action:none; -webkit-user-select:none; user-select:none;
    }

    .draggable{ position:absolute; touch-action:none; cursor:move; }
    .dragging{ pointer-events:none; }
    .plate{ user-select:none }
    .plate>img{ width:100%; height:100%; display:block }

    .plate > img,
    #carContainer img{
      pointer-events:auto;
      -webkit-user-drag:none;
      user-select:none;
    }

    .zone{ position:absolute; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
    .car-img{width:500px;height:auto;display:block}

    .top-category,.car-category{font-family:var(--digits-font);line-height:1;color:#fff;text-shadow:0 0 1px rgba(0,0,0,.35)}
    .top-number,.car-number{font-family:var(--digits-font);line-height:1;color:#000;letter-spacing:.04em}

    .price{font-size:26px;font-weight:700;color:#111;background:transparent;padding:6px 12px;border-radius:10px;user-select:none}

    .controls{margin-top:14px;display:flex;flex-wrap:wrap;gap:10px 12px;justify-content:center;align-items:center}
    .controls label{font-size:14px}
    .controls input,.controls button,.controls select{padding:8px 12px;font-size:15px;font-family:'Tajawal',sans-serif}

    .lock-zones #topPlate .zone,
    .lock-zones #carPlate .zone{ pointer-events:none !important; }
  </style>
</head>
<body>

  <h2>تصميم لوحة سيارة أبوظبي — بخط FE مضبوط</h2>

  <div id="capture">
    <!-- اللوحة العلوية -->
    <div class="plate draggable" id="topPlate" style="left:20px; top:20px; width:500px; height:110px;">
      <img src="plate-real.png" alt="لوحة علوية" draggable="false">
      <div class="zone draggable" id="topCatZone" style="left:12px; top:8px; width:120px; height:94px;">
        <div class="top-category" id="topCategory" style="font-size:44px;">1</div>
      </div>
      <div class="zone draggable" id="topNumZone" style="left:200px; top:6px; width:300px; height:98px;">
        <div class="top-number" id="topNumber" style="font-size:78px;">12345</div>
      </div>
    </div>

    <!-- السيارة -->
    <div class="draggable" id="carContainer" style="left:20px; top:220px;">
      <img src="defender.png" class="car-img" alt="السيارة" id="carImg" draggable="false">
    </div>

    <!-- اللوحة السفلية -->
    <div class="plate draggable" id="carPlate" style="left:210px; top:520px; width:150px; height:35px;">
      <img src="plate-real.png" alt="لوحة سفلية" draggable="false">
      <div class="zone draggable" id="carCatZone" style="left:8px; top:0; width:35%; height:100%;">
        <div class="car-category" id="bottomCategory" style="font-size:10px;">1</div>
      </div>
      <div class="zone draggable" id="carNumZone" style="left:42px; top:0; width:62%; height:100%;">
        <div class="car-number" id="bottomNumber" style="font-size:16px;">12345</div>
      </div>
    </div>

    <!-- السعر -->
    <div class="price draggable" id="price" style="left:150px; top:760px;">
      <span class="label">السعر:</span><span id="platePrice">250,000 درهم</span>
    </div>
  </div>

  <div class="controls">
    <label>السيارة:
      <select id="carSelect">
        <option value="defender" selected>Land Rover Defender</option>
        <option value="g_class">Mercedes G-Class</option>
      </select>
    </label>

    <label>فئة: <input type="text" id="inputCategory" value="1"></label>
    <label>رقم: <input type="text" id="inputNumber" value="12345"></label>
    <label>السعر (درهم): <input type="text" id="inputPrice" value="250000"></label>

    <label style="display:flex;align-items:center;gap:8px;">
      <input type="checkbox" id="toggleLockZones"> قفل محتوى اللوحات
    </label>

    <button id="btnUpdate">تحديث</button>
    <button id="btnDownload">📸 تحميل الصورة</button>
  </div>

  <script>
    const CAR_PRESETS = {
      defender: { img:'defender.png' },
      g_class:  { img:'g_class.png' }
    };

    const captureEl=document.getElementById('capture');
    const carImgEl=document.getElementById('carImg');
    const lockToggle=document.getElementById('toggleLockZones');
    const bodyEl=document.body;

    function makeDraggable(el,boundsEl){
      let startX=0,startY=0,origL=0,origT=0,dragging=false;
      const pt=(e)=> e.touches?{x:e.touches[0].clientX,y:e.touches[0].clientY}:{x:e.clientX,y:e.clientY};
      const down=(e)=>{e.preventDefault();dragging=true;
        const p=pt(e),r=el.getBoundingClientRect(),b=(boundsEl||el.parentElement).getBoundingClientRect();
        startX=p.x;startY=p.y;origL=r.left-b.left;origT=r.top-b.top;
        document.addEventListener('mousemove',move,{passive:false});
        document.addEventListener('mouseup',up,{passive:false});
        document.addEventListener('touchmove',move,{passive:false});
        document.addEventListener('touchend',up,{passive:false});
      };
      const move=(e)=>{if(!dragging)return;const p=pt(e);let L=origL+(p.x-startX),T=origT+(p.y-startY);
        const b=(boundsEl||el.parentElement).getBoundingClientRect(),r=el.getBoundingClientRect();
        L=Math.max(0,Math.min(L,b.width-r.width));T=Math.max(0,Math.min(T,b.height-r.height));
        el.style.left=L+'px';el.style.top=T+'px';};
      const up=()=>{dragging=false;
        document.removeEventListener('mousemove',move);
        document.removeEventListener('mouseup',up);
        document.removeEventListener('touchmove',move);
        document.removeEventListener('touchend',up);};
      el.addEventListener('mousedown',down,{passive:false});
      el.addEventListener('touchstart',down,{passive:false});
    }

    // عناصر قابلة للسحب
    makeDraggable(document.getElementById('topPlate'), captureEl);
    makeDraggable(document.getElementById('carContainer'), captureEl);
    makeDraggable(document.getElementById('carPlate'), captureEl);
    makeDraggable(document.getElementById('price'), captureEl);

    // قفل/فتح السحب داخل اللوحات
    lockToggle.addEventListener('change',()=>{
      bodyEl.classList.toggle('lock-zones', lockToggle.checked);
    });

    // تحديث القيم
    function update(){
      const cat=document.getElementById('inputCategory').value||'1';
      const num=document.getElementById('inputNumber').value||'12345';
      const price=document.getElementById('inputPrice').value||'250000';
      document.getElementById('topCategory').textContent=cat;
      document.getElementById('bottomCategory').textContent=cat;
      document.getElementById('topNumber').textContent=num;
      document.getElementById('bottomNumber').textContent=num;
      document.getElementById('platePrice').textContent=Number(price).toLocaleString('ar-AE')+" درهم";
    }
    document.getElementById('btnUpdate').onclick=update;

    // تحميل الصورة (انتظار الخط)
    async function downloadCapture(){
      if(document.fonts && document.fonts.ready){await document.fonts.ready;}
      const canvas=await html2canvas(captureEl,{backgroundColor:null,scale:2});
      const a=document.createElement('a');a.download='plate.png';a.href=canvas.toDataURL('image/png');a.click();
    }
    document.getElementById('btnDownload').onclick=downloadCapture;

    // اختيار السيارة
    document.getElementById('carSelect').onchange=(e)=> carImgEl.src=CAR_PRESETS[e.target.value].img;
  </script>
</body>
</html>
